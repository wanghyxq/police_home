# 角色鉴权与页面跳转逻辑实现计划

根据您的要求，我们需要在登录后根据用户角色进行页面跳转，并对民警端页面进行访问控制。

## 1. 登录后跳转逻辑 (`pages/login.vue`)

在 `loginSuccess` 方法中，我们将修改原本直接跳转到 `/pages/index` 的逻辑，改为根据角色判断：

*   **理发师角色** (`barber`)：跳转至 `/pages/barber/dashboard`。
*   **其他角色**（默认民警/管理员）：跳转至 `/pages/index`。

我们需要先通过 `this.$store.dispatch('GetInfo')` 获取用户信息，然后检查 `res.roles` 数组中是否包含 `barber`。

## 2. 页面访问控制 (`permission.js`)

我们需要修改全局路由拦截器，防止理发师访问民警端页面，反之亦然（可选，目前重点是保护民警端）。

*   **民警端页面**：`/pages/index` (及可能的其他民警专属页面)。
*   **拦截逻辑**：
    *   在 `uni.addInterceptor` 中，获取当前目标 URL。
    *   如果目标是 `/pages/index` 且当前用户角色包含 `barber`，则重定向回 `/pages/barber/dashboard`。
    *   或者更严格地，维护一份角色-页面白名单。

## 3. 实施步骤

1.  **修改 `pages/login.vue`**：
    *   在 `loginSuccess` 中，获取 `res.roles`。
    *   判断 `roles.includes('barber')` (假设理发师角色标识为 'barber'，需确认后端返回的真实 key，这里暂定为 'barber' 或 'common'，建议先打印日志确认，或者按照常规若依逻辑，理发师应该有独立的角色标识)。
    *   执行差异化跳转。

2.  **修改 `permission.js`**：
    *   增加对 `/pages/index` 的角色检查。
    *   增加对 `/pages/barber/*` 的角色检查（防止民警误入）。

3.  **验证**：
    *   使用理发师账号登录 -> 验证是否跳到工作台。
    *   使用民警账号登录 -> 验证是否跳到首页。
    *   尝试直接输入 URL 访问对方页面 -> 验证是否被拦截。

**注**：由于目前无法直接确认后端返回的理发师角色 Key（通常是 `admin`, `common` 等），我将在代码中假设理发师的角色 Key 为 `barber`。如果实际测试发现不对，需要根据实际返回值（`res.roles`）进行调整。

考虑到您提到“民警端页面仅允许民警用户 or 管理员访问”，我们将假定民警/管理员的角色 Key 包含 `admin` 或 `police` (或默认角色)。

**Action**: 我将重点修改 `pages/login.vue` 的跳转逻辑，并检查 `permission.js`（如果存在）或创建一个简单的权限守卫。

(补充：通过之前的 `LS` 结果，项目根目录下有 `permission.js`，我将读取并修改它)