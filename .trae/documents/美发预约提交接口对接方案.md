# 美发预约提交接口对接计划

我们将按照您的要求，实现 `book.vue` 与后端预约提交接口的对接。

## 1. 接口层更新 (`api/haircut/haircut.js`)

*   **更新接口地址**：将 `submitAppointment` 方法的请求 URL 从 `/api/haircut/appointment` 修改为 `/api/haircut/appointment/submit`。
*   **保持一致性**：确保请求方法仍为 `POST`，且接收 `data` 对象作为请求体。

## 2. 页面逻辑层更新 (`pages/haircut/book.vue`)

### A. 状态管理
*   在 `data` 中新增 `submitting` 字段（布尔值），用于标记提交状态，防止重复点击。

### B. 交互优化
*   修改“立即预约”按钮：
    *   绑定 `disabled` 属性：当 `!selectedTime` 或 `submitting` 为真时禁用。
    *   根据禁用状态动态调整样式（如变灰）。

### C. 提交逻辑 (`submit` 方法)
我们将重构 `submit` 方法，严格执行以下流程：

1.  **参数校验**：
    *   检查 `barberId`、`scheduleDate`、`startTime` 是否存在。
    *   若校验不通过，通过 `uni.showToast` 提示。

2.  **状态控制**：
    *   点击后立即设置 `submitting = true`。
    *   调用 `uni.showLoading({ title: '提交中...' })`。

3.  **调用接口**：
    *   调用 `submitAppointment(data)`。

4.  **响应处理**：
    *   **成功**：
        *   提示“操作成功”。
        *   延迟 1.5 秒后跳转至成功页面（`success.vue`），以便用户看清提示。
    *   **失败**：
        *   捕获异常（`catch` 块）。
        *   根据后端返回的 `msg` 内容进行特定处理：
            *   包含“该时段已被预约” -> 弹出模态框提示重新选择，并在关闭后刷新排班。
            *   包含“已有预约” -> 弹出模态框提示。
            *   其他错误 -> 使用 `uni.showToast` 显示后端返回的错误信息。
    *   **清理**：
        *   无论成功失败，均执行 `uni.hideLoading()` 和 `submitting = false`。

## 3. 实施步骤

1.  **修改 API 文件**：更新 `api/haircut/haircut.js` 中的 URL。
2.  **修改 Vue 组件**：更新 `book.vue` 的 `data`、`template`（按钮部分）和 `submit` 方法。
3.  **验证**：模拟提交，验证成功跳转、重复提交拦截及错误提示逻辑。